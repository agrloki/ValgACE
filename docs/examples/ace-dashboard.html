<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ValgACE Control Panel</title>
    <link rel="stylesheet" href="ace-dashboard.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="ace-dashboard-config.js"></script>
</head>
<body>
    <div id="app">
        <div class="container">
            <!-- Header -->
            <header class="header">
                <h1>üé® ValgACE Control Panel</h1>
                <div class="connection-status" :class="{ connected: wsConnected, disconnected: !wsConnected }">
                    <span class="status-dot"></span>
                    <span>{{ wsConnected ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ' : '–û—Ç–∫–ª—é—á–µ–Ω–æ' }}</span>
                </div>
            </header>

            <!-- Device Status Card -->
            <div class="card device-status-card">
                <h2>–°—Ç–∞—Ç—É—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h2>
                <div class="device-info">
                    <div class="info-row">
                        <span class="label">–ú–æ–¥–µ–ª—å:</span>
                        <span class="value">{{ deviceStatus.model || 'Unknown' }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">–ü—Ä–æ—à–∏–≤–∫–∞:</span>
                        <span class="value">{{ deviceStatus.firmware || 'Unknown' }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">–°—Ç–∞—Ç—É—Å:</span>
                        <span class="value status-badge" :class="deviceStatus.status">
                            {{ getStatusText(deviceStatus.status) }}
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</span>
                        <span class="value">{{ deviceStatus.temp || 0 }}¬∞C</span>
                    </div>
                    <div class="info-row">
                        <span class="label">–í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä:</span>
                        <span class="value">{{ deviceStatus.fan_speed || 0 }} RPM</span>
                    </div>
                    <div class="info-row">
                        <span class="label">RFID:</span>
                        <span class="value">{{ deviceStatus.enable_rfid ? '–í–∫–ª—é—á–µ–Ω' : '–í—ã–∫–ª—é—á–µ–Ω' }}</span>
                    </div>
                </div>
            </div>

            <!-- Dryer Control Card -->
            <div class="card dryer-card">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—É—à–∫–æ–π</h2>
                <div class="dryer-status">
                    <div class="dryer-info">
                        <div class="info-row">
                            <span class="label">–°—Ç–∞—Ç—É—Å:</span>
                            <span class="value status-badge" :class="dryerStatus.status">
                                {{ getDryerStatusText(dryerStatus.status) }}
                            </span>
                        </div>
                        <div class="info-row" v-if="dryerStatus.status === 'drying'">
                            <span class="label">–¶–µ–ª–µ–≤–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</span>
                            <span class="value">{{ dryerStatus.target_temp }}¬∞C</span>
                        </div>
                        <div class="info-row" v-if="dryerStatus.status === 'drying'">
                            <span class="label">–û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏:</span>
                            <span class="value">{{ formatTime(dryerStatus.remain_time) }}</span>
                        </div>
                    </div>
                    <div class="dryer-controls">
                        <div class="control-group">
                            <label>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C):</label>
                            <input type="number" v-model.number="dryingTemp" min="20" max="55" :disabled="dryerStatus.status === 'drying'">
                        </div>
                        <div class="control-group">
                            <label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω):</label>
                            <input type="number" v-model.number="dryingDuration" min="1" max="1440" :disabled="dryerStatus.status === 'drying'">
                        </div>
                        <div class="button-group">
                            <button @click="startDrying" :disabled="dryerStatus.status === 'drying'" class="btn btn-primary">
                                –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å—É—à–∫—É
                            </button>
                            <button @click="stopDrying" :disabled="dryerStatus.status === 'stop'" class="btn btn-danger">
                                –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slots Grid -->
            <div class="card slots-card">
                <h2>–°–ª–æ—Ç—ã —Ñ–∏–ª–∞–º–µ–Ω—Ç–∞</h2>
                <div class="slots-grid">
                    <div 
                        v-for="slot in slots" 
                        :key="slot.index"
                        class="slot-card"
                        :class="{ 
                            ready: slot.status === 'ready',
                            empty: slot.status === 'empty',
                            busy: slot.status === 'busy',
                            active: currentTool === slot.index
                        }"
                    >
                        <div class="slot-header">
                            <h3>–°–ª–æ—Ç {{ slot.index }}</h3>
                            <span class="slot-status-badge" :class="slot.status">
                                {{ getSlotStatusText(slot.status) }}
                            </span>
                        </div>
                        
                        <div class="slot-color" :style="{ backgroundColor: getColorHex(slot.color) }">
                            <span class="color-label">{{ getColorHex(slot.color) }}</span>
                        </div>
                        
                        <div class="slot-info">
                            <div class="info-item">
                                <span class="label">–¢–∏–ø:</span>
                                <span class="value">{{ slot.type || '–ù–µ —É–∫–∞–∑–∞–Ω' }}</span>
                            </div>
                            <div class="info-item">
                                <span class="label">SKU:</span>
                                <span class="value">{{ slot.sku || '–ù–µ —É–∫–∞–∑–∞–Ω' }}</span>
                            </div>
                            <div class="info-item">
                                <span class="label">RFID:</span>
                                <span class="value">{{ getRfidStatusText(slot.rfid) }}</span>
                            </div>
                        </div>
                        
                        <div class="slot-actions">
                            <button 
                                @click="changeTool(slot.index)" 
                                :disabled="slot.status !== 'ready' || currentTool === slot.index"
                                class="btn btn-sm btn-primary"
                            >
                                –ó–∞–≥—Ä—É–∑–∏—Ç—å
                            </button>
                            <button 
                                @click="parkToToolhead(slot.index)" 
                                :disabled="slot.status !== 'ready'"
                                class="btn btn-sm btn-secondary"
                            >
                                –ü–∞—Ä–∫–æ–≤–∫–∞
                            </button>
                            <button 
                                @click="toggleFeedAssist(slot.index)" 
                                :disabled="slot.status !== 'ready'"
                                class="btn btn-sm"
                                :class="feedAssistSlot === slot.index ? 'btn-success' : 'btn-outline-success'"
                            >
                                {{ feedAssistSlot === slot.index ? '–ê—Å–∏—Å—Ç –í–ö–õ' : '–ê—Å–∏—Å—Ç' }}
                            </button>
                            <button 
                                @click="showFeedDialog(slot.index)" 
                                :disabled="slot.status !== 'ready'"
                                class="btn btn-sm btn-info"
                            >
                                –ü–æ–¥–∞—á–∞
                            </button>
                            <button 
                                @click="showRetractDialog(slot.index)" 
                                :disabled="slot.status !== 'ready'"
                                class="btn btn-sm btn-warning"
                            >
                                –û—Ç–∫–∞—Ç
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card quick-actions-card">
                <h2>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
                <div class="quick-actions">
                    <button @click="unloadFilament" class="btn btn-danger">
                        –í—ã–≥—Ä—É–∑–∏—Ç—å —Ñ–∏–ª–∞–º–µ–Ω—Ç
                    </button>
                    <button @click="refreshStatus" class="btn btn-secondary">
                        –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
                    </button>
                </div>
            </div>
        </div>

        <!-- Feed Dialog -->
        <div v-if="showFeedModal" class="modal-overlay" @click="closeFeedDialog">
            <div class="modal" @click.stop>
                <h3>–ü–æ–¥–∞—á–∞ —Ñ–∏–ª–∞–º–µ–Ω—Ç–∞ - –°–ª–æ—Ç {{ feedSlot }}</h3>
                <div class="form-group">
                    <label>–î–ª–∏–Ω–∞ (–º–º):</label>
                    <input type="number" v-model.number="feedLength" min="1" max="2000">
                </div>
                <div class="form-group">
                    <label>–°–∫–æ—Ä–æ—Å—Ç—å (–º–º/—Å):</label>
                    <input type="number" v-model.number="feedSpeed" min="1" max="100">
                </div>
                <div class="modal-actions">
                    <button @click="executeFeed" class="btn btn-primary">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
                    <button @click="closeFeedDialog" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <!-- Retract Dialog -->
        <div v-if="showRetractModal" class="modal-overlay" @click="closeRetractDialog">
            <div class="modal" @click.stop>
                <h3>–û—Ç–∫–∞—Ç —Ñ–∏–ª–∞–º–µ–Ω—Ç–∞ - –°–ª–æ—Ç {{ retractSlot }}</h3>
                <div class="form-group">
                    <label>–î–ª–∏–Ω–∞ (–º–º):</label>
                    <input type="number" v-model.number="retractLength" min="1" max="2000">
                </div>
                <div class="form-group">
                    <label>–°–∫–æ—Ä–æ—Å—Ç—å (–º–º/—Å):</label>
                    <input type="number" v-model.number="retractSpeed" min="1" max="100">
                </div>
                <div class="modal-actions">
                    <button @click="executeRetract" class="btn btn-primary">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
                    <button @click="closeRetractDialog" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <!-- Notification Toast -->
        <div v-if="notification.show" class="toast" :class="notification.type">
            {{ notification.message }}
        </div>
    </div>

    <script src="ace-dashboard.js"></script>
</body>
</html>

